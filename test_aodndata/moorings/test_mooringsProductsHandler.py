import httpretty
import os
import re
import unittest

from aodncore.pipeline import PipelineFilePublishType, PipelineFileCheckType, FileType
from aodncore.pipeline.exceptions import ComplianceCheckFailedError, InvalidFileContentError, InvalidFileNameError
from aodncore.testlib import HandlerTestCase, make_zip
from aodndata.moorings.products_handler import MooringsProductsHandler

TEST_ROOT = os.path.dirname(__file__)
GOOD_MANIFEST = os.path.join(TEST_ROOT, 'product_manifest.json')

GETCAPABILITIES_FILE = os.path.join(TEST_ROOT, 'getCapabilities.xml')

with open(GETCAPABILITIES_FILE) as f:
    TEST_GETCAPABILITIES_RESPONSE = httpretty.Response(f.read())

TEST_GETFEATURE_RESPONSE = httpretty.Response(
    """{"type":"FeatureCollection","features":[{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7acd","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Biogeochem_timeseries/IMOS_ANMN-NRS_BCKOSTUZ_20170724T080040Z_NRSROT_FV01_NRSROT-1707-WQM-55_END-20171129T011610Z_C-20180502T051912Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ace","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Biogeochem_timeseries/IMOS_ANMN-NRS_EKTUZ_20170724T080000Z_NRSROT_FV01_NRSROT-1707-ACLW-USB-24_END-20171129T091501Z_C-20180502T051911Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7acf","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/CTD_timeseries/IMOS_ANMN-NRS_CSTZ_20170724T080001Z_NRSROT_FV01_NRSROT-1707-SBE37SM-RS232-24_END-20171129T020001Z_C-20180502T051910Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad0","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20170724T080000Z_NRSROT_FV01_NRSROT-1707-SBE39-33_END-20171129T012000Z_C-20180502T051911Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad1","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Biogeochem_timeseries/IMOS_ANMN-NRS_BCKOSTUZ_20170724T080040Z_NRSROT_FV01_NRSROT-1707-WQM-55_END-20170724T181659Z_C-20190607T000000Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad2","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20170724T080000Z_NRSROT_FV01_NRSROT-1707-SBE39-27_END-20171129T014000Z_C-20180502T051911Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad3","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/CTD_timeseries/IMOS_ANMN-NRS_CSTZ_20171128T080001Z_NRSROT_FV01_NRSROT-1712-SBE3x-24_END-20180409T010001Z_C-20180503T020212Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad4","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/CTD_timeseries/IMOS_ANMN-NRS_CSTZ_20180406T080001Z_NRSROT_FV01_NRSROT-1804-SBE37SM-RS232-24_END-20180817T044501Z_C-20180820T010303Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad5","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/CTD_timeseries/IMOS_ANMN-NRS_CSTZ_20180816T080001Z_NRSROT_FV01_NRSROT-1808-SBE37SM-RS232-24_END-20181214T014501Z_C-20181217T041211Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad6","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20081120T080000Z_NRSROT_FV01_NRSROT-0811-SBE39-27_END-20090219T030000Z_C-20180810T044335Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad7","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20081120T080000Z_NRSROT_FV01_NRSROT-0811-SBE39-35_END-20090219T041500Z_C-20180810T044336Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad8","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20090220T070000Z_NRSROT_FV01_NRSROT-0902-SBE39-27_END-20090714T052500Z_C-20180810T035727Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ad9","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20090220T070000Z_NRSROT_FV01_NRSROT-0902-SBE39-33_END-20090714T034500Z_C-20180810T035727Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ada","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20091105T080000Z_NRSROT_FV01_NRSROT-0911-SBE39-27_END-20100225T031500Z_C-20180810T014224Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7adb","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20091105T080000Z_NRSROT_FV01_NRSROT-0911-SBE39-33_END-20100226T055000Z_C-20180810T014224Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7adc","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20100226T080000Z_NRSROT_FV01_NRSROT-1002-SBE39-27_END-20100603T075000Z_C-20180810T004750Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7add","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20100226T080000Z_NRSROT_FV01_NRSROT-1002-SBE39-33_END-20100603T072500Z_C-20180810T004751Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ade","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20100603T032000Z_NRSROT_FV01_NRSROT-1006-SBE39-27_END-20100903T021500Z_C-20180817T011215Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7adf","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20100603T032000Z_NRSROT_FV01_NRSROT-1006-SBE39-33_END-20100903T021000Z_C-20180817T011215Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae0","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20100903T080000Z_NRSROT_FV01_NRSROT-1009-SBE39-27_END-20101215T005500Z_C-20180510T010554Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae1","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20100903T080000Z_NRSROT_FV01_NRSROT-1009-SBE39-33_END-20101215T005500Z_C-20180510T010555Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae2","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20101215T080000Z_NRSROT_FV01_NRSROT-1012-SBE39-27_END-20110527T051000Z_C-20180823T054545Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae3","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20101215T080000Z_NRSROT_FV01_NRSROT-1012-SBE39-33_END-20110527T051000Z_C-20180823T054545Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae4","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20110527T080000Z_NRSROT_FV01_NRSROT-1105-SBE39-27_END-20111006T023000Z_C-20180509T064729Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae5","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20110527T080000Z_NRSROT_FV01_NRSROT-1105-SBE39-33_END-20111006T023000Z_C-20180509T064730Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae6","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20111006T080000Z_NRSROT_FV01_NRSROT-1110-SBE39-27_END-20120130T011500Z_C-20180823T060029Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae7","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20111006T080000Z_NRSROT_FV01_NRSROT-1110-SBE39-33_END-20120130T011500Z_C-20180823T060029Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae8","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20120130T080000Z_NRSROT_FV01_NRSROT-1201-SBE39-27_END-20120525T013000Z_C-20180823T061420Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7ae9","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20120130T080000Z_NRSROT_FV01_NRSROT-1201-SBE39-33_END-20120525T013000Z_C-20180823T061420Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aea","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20120525T080000Z_NRSROT_FV01_NRSROT-1205-SBE39-27_END-20120928T073500Z_C-20180509T022153Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aeb","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20120525T080000Z_NRSROT_FV01_NRSROT-1205-SBE39-33_END-20120928T073000Z_C-20180509T022153Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aec","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20120928T080000Z_NRSROT_FV01_NRSROT-1209-SBE39-27_END-20130130T080500Z_C-20180509T015240Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aed","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20120928T080000Z_NRSROT_FV01_NRSROT-1209-SBE39-33_END-20130130T073000Z_C-20180509T015240Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aee","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20130125T080000Z_NRSROT_FV01_NRSROT-1301-SBE39-27_END-20130520T022000Z_C-20180509T012735Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aef","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20130125T080000Z_NRSROT_FV01_NRSROT-1301-SBE39-33_END-20130520T031000Z_C-20180509T012735Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af0","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20130517T080000Z_NRSROT_FV01_NRSROT-1305-SBE39-27_END-20131014T061000Z_C-20180508T070420Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af1","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20130517T080000Z_NRSROT_FV01_NRSROT-1305-SBE39-33_END-20131014T064500Z_C-20180508T070420Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af2","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20131011T080000Z_NRSROT_FV01_NRSROT-1310-SBE39-27_END-20140214T024000Z_C-20180508T042538Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af3","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20131011T080000Z_NRSROT_FV01_NRSROT-1310-SBE39-33_END-20140214T025000Z_C-20180508T042538Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af4","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20140213T080000Z_NRSROT_FV01_NRSROT-1402-SBE39-27_END-20140711T070000Z_C-20180508T033322Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af5","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20140213T080000Z_NRSROT_FV01_NRSROT-1402-SBE39-33_END-20140530T061000Z_C-20180508T033322Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af6","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20140808T080000Z_NRSROT_FV01_NRSROT-1408-SBE39-27_END-20141217T051000Z_C-20180508T013222Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af7","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20140808T080000Z_NRSROT_FV01_NRSROT-1408-SBE39-33_END-20141217T054500Z_C-20180508T013222Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af8","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20140808T080000Z_NRSROT_FV01_NRSROT-1408-SBE39-43_END-20141217T044500Z_C-20180508T013222Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7af9","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20140808T080000Z_NRSROT_FV01_NRSROT-1408-TDR-2050-57_END-20141217T055500Z_C-20180508T013223Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7afa","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20141215T160000Z_NRSROT_FV01_NRSROT-1412-SBE39-33_END-20150331T063000Z_C-20180508T001839Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7afb","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20141216T080000Z_NRSROT_FV01_NRSROT-1412-SBE39-27_END-20150331T061500Z_C-20180508T001839Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7afc","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20141216T080000Z_NRSROT_FV01_NRSROT-1412-SBE39-43_END-20150331T063000Z_C-20180508T001839Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7afd","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20141216T080000Z_NRSROT_FV01_NRSROT-1412-TDR-2050-57_END-20150331T065000Z_C-20180508T001840Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7afe","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150330T080000Z_NRSROT_FV01_NRSROT-1503-SBE39-27_END-20150727T044000Z_C-20180507T064754Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7aff","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150330T080000Z_NRSROT_FV01_NRSROT-1503-SBE39-33_END-20150727T050000Z_C-20180507T064755Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b00","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150330T080000Z_NRSROT_FV01_NRSROT-1503-SBE39-43_END-20150727T052000Z_C-20180507T064755Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b01","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150330T080000Z_NRSROT_FV01_NRSROT-1503-TDR-2050-57_END-20150727T022600Z_C-20180507T064756Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b02","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150724T080000Z_NRSROT_FV01_NRSROT-1507-SBE39-27_END-20151208T061000Z_C-20180507T041734Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b03","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150724T080000Z_NRSROT_FV01_NRSROT-1507-SBE39-33_END-20151209T045000Z_C-20180507T041734Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b04","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20150724T080000Z_NRSROT_FV01_NRSROT-1507-SBE39-43_END-20151209T051000Z_C-20180507T041734Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b05","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20151208T080000Z_NRSROT_FV01_NRSROT-1512-SBE39-27_END-20160411T024000Z_C-20180504T071458Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b06","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20151208T080000Z_NRSROT_FV01_NRSROT-1512-SBE39-33_END-20160411T045000Z_C-20180504T071458Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b07","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20151208T080000Z_NRSROT_FV01_NRSROT-1512-SBE39-43_END-20160411T042000Z_C-20180504T071458Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b08","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20151208T080000Z_NRSROT_FV01_NRSROT-1512-TDR-2050-57_END-20160408T063800Z_C-20180504T071459Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b09","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20160408T080000Z_NRSROT_FV01_NRSROT-1604-SBE39-27_END-20161012T040000Z_C-20180504T030840Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b0a","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20160408T080000Z_NRSROT_FV01_NRSROT-1604-SBE39-33_END-20161012T032000Z_C-20180504T030840Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b0b","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20160408T080000Z_NRSROT_FV01_NRSROT-1604-SBE39-43_END-20161011T063000Z_C-20180504T030841Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b0c","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20161011T080000Z_NRSROT_FV01_NRSROT-1610-SBE39-27_END-20170327T060000Z_C-20180504T022803Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b0d","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20161011T080000Z_NRSROT_FV01_NRSROT-1610-SBE39-33_END-20170327T053000Z_C-20180504T022803Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b0e","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20161011T080000Z_NRSROT_FV01_NRSROT-1610-SBE39-43_END-20170327T054000Z_C-20180504T022803Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b0f","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20170322T080000Z_NRSROT_FV01_NRSROT-1703-SBE39-27_END-20170725T054000Z_C-20180503T064159Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b10","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20170322T080000Z_NRSROT_FV01_NRSROT-1703-SBE39-33_END-20170725T034000Z_C-20180503T064159Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b11","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20170322T080000Z_NRSROT_FV01_NRSROT-1703-SBE39-43_END-20170725T060000Z_C-20180503T064159Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b12","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20170724T080000Z_NRSROT_FV01_NRSROT-1707-SBE39-43_END-20171129T013000Z_C-20180502T051912Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b13","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20171124T080000Z_NRSROT_FV01_NRSROT-1712-SBE39-27_END-20180409T062000Z_C-20180503T020213Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b14","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20171124T080000Z_NRSROT_FV01_NRSROT-1712-SBE39-33_END-20180409T062000Z_C-20180503T020213Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b15","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20171124T080000Z_NRSROT_FV01_NRSROT-1712-SBE39-43_END-20180409T060000Z_C-20180503T020214Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b16","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20171124T080000Z_NRSROT_FV01_NRSROT-1712-TDR-2050-57_END-20180409T023500Z_C-20180503T020215Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b17","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20180406T080000Z_NRSROT_FV01_NRSROT-1804-SBE39-27_END-20180817T023000Z_C-20180820T010304Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b18","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20180406T080000Z_NRSROT_FV01_NRSROT-1804-SBE39-43_END-20180817T025000Z_C-20180820T010304Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b19","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20180816T080000Z_NRSROT_FV01_NRSROT-1808-SBE39-27_END-20181214T034000Z_C-20181217T041212Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b1a","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20180816T080000Z_NRSROT_FV01_NRSROT-1808-SBE39-33_END-20181214T032000Z_C-20181217T041212Z.nc"}},{"type":"Feature","id":"moorings_all_map.fid--44e8da32_16d0014d48c_7b1b","geometry":null,"properties":{"url":"IMOS/ANMN/NRS/NRSROT/Temperature/IMOS_ANMN-NRS_TZ_20180816T080000Z_NRSROT_FV01_NRSROT-1808-SBE39-43_END-20181214T030000Z_C-20181217T041213Z.nc"}}],"totalFeatures":79,"numberMatched":79,"numberReturned":79,"timeStamp":"2019-09-05T06:33:53.380Z","crs":null}
""")


class TestMooringsProductsHandler(HandlerTestCase):
    def setUp(self):
        self.handler_class = MooringsProductsHandler
        super(TestMooringsProductsHandler, self).setUp()

    @httpretty.activate
    def test_good_manifest(self):
        httpretty.register_uri(httpretty.GET, self.config.pipeline_config['global']['wfs_url'],
                               responses=[TEST_GETCAPABILITIES_RESPONSE, TEST_GETFEATURE_RESPONSE])
        self.run_handler(GOOD_MANIFEST)


if __name__ == '__main__':
    unittest.main()
